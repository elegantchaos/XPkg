#!/bin/bash

ROOT="$HOME/.local/share/xpkg"

echo "Building."
swift run builder build
if [[ $? != 0 ]]
then
    echo "Build failed."
    exit 1
fi

LOCAL="$HOME/.local"
echo "Installing links."
if [[ -e "$LOCAL" ]]
then
    STARTUP="$LOCAL/share/bash-hooks/startup"
    BIN="$LOCAL/bin"
    SUDO=
else
    STARTUP="/usr/local/share/bash-hooks/startup"
    BIN="/usr/local/bin"
    SUDO=sudo
fi

$SUDO mkdir -p "$STARTUP"
$SUDO ln -sf "$ROOT/code/.bin/xpkg-bash" "$STARTUP/xpkg"
$SUDO ln -sf "$ROOT/code/.build/debug/xpkg" "$BIN/xpkg"


echo "Done."
