#!/bin/bash

ROOT="$HOME/.local/share/xpkg"

echo "Building."
swift run builder build
if [[ $? != 0 ]]
then
    echo "Build failed."
    exit 1
fi

LOCALBIN="$HOME/.local/bin"
echo "Installing links."
if [[ -e "$LOCALBIN" ]]
then
    LOCALSTARTUP="$HOME/.local/share/bash-hooks/startup"
    mkdir -p "$LOCALSTARTUP"
    ln -sf "$ROOT/code/.build/debug/xpkg" "$LOCALBIN/xpkg"
    ln -sf "$ROOT/code/.bin/xpkg-bash" "$LOCALSTARTUP/xpkg"
else
    sudo ln -sf "$ROOT/code/.build/debug/xpkg" "/usr/local/bin/xpkg"
    echo "$GOSCRIPT" > "/usr/local/bin/xg"
fi

echo "Done."
