#!/bin/bash

ROOT="$HOME/.config/xpkg"

if [[ -e "$ROOT/code" ]]
then
    echo "Updating xpkg."
    cd "$ROOT/code"
    git pull
else
    echo "Downloading xpkg."
    mkdir -p "$ROOT"
    cd "$ROOT"
    git clone https://github.com/elegantchaos/xpkg.git code
    cd code
fi

echo "Building."
swift run builder build
if [[ $? != 0 ]]
then
    echo "Build failed."
    exit 1
fi

LOCALBIN=~/.local/bin

echo "Installing links."
if [[ -e "$LOCALBIN" ]]
then
    ln -sf "$ROOT/code/.build/debug/xpkg" "$LOCALBIN/xpkg"
else
    sudo ln -sf "$ROOT/code/.build/debug/xpkg" "/usr/local/bin/xpkg"
fi

echo "Done."
